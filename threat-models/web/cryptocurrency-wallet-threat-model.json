{
    "$schema": "https://github.com/OWASP/www-project-threat-model-library/blob/v1.0.1/threat-model.schema.json",
    "version": "1.0",
    "title": "Cryptocurrency Wallet & Exchange System",
    "description": "Threat model derived from OWASP-style diagram covering a desktop wallet, mobile app, exchange backend/API, and blockchain interaction.",
    "scope": {
      "title": "Electrum Wallet + Exchange + Blockchain Integration",
      "description": "All components shown in the diagram, including wallet, exchange backend & API, mobile app, and blockchain integration. Out of scope: user’s OS, hardware device, third-party dependencies not shown.",
      "business_criticality": "high",
      "data_sensitivity": [
        "biz",
        "cred"
      ],
      "exposure": "external",
      "tier": "business_critical"
    },
    "description": "A data flow diagram of a cryptocurrency wallet submitted by Jonathan Marcil to the OWASP Threat Model Cookbook.",
    "frozen": false,
    "release_docs_link": "https://github.com/OWASP/threat-model-cookbook/tree/master/Flow%20Diagram/cryptocurrency-wallet",
    "reviewed_at": "2025-12-05",
    "repo_link": "https://github.com/OWASP/threat-model-cookbook",
    "diagrams": [
        {
          "title": "Cryptocurrency Wallet DFD",
          "type": "mermaid",
          "source": "flowchart LR; User --> GUI; User --> Browser; User --> MobileApp; GUI --> Daemon; Daemon -- \"HTTP JSON-RPC (localhost random port)\" --> Browser; Daemon -- \"TCP+SSL 50002<br/>JSON-RPC\" --> ElectrumX; ElectrumX -- SPV --> Blockchain; Browser -- HTTPS --> ExchangeWeb; ExchangeWeb -- HTTPS --> ExchangeBackend; ExchangeBackend -- HTTP --> ExchangeAPI; ExchangeAPI --> MongoDB; ExchangeAPI --> BlockchainIntegration; BlockchainIntegration --> Blockchain; MobileApp -- HTTPS --> ExchangeAPI; TradingBot -- \"WebSocket Secure\" --> ExchangeAPI; ExchangeBackend -. \"MySQL user & config\" .-> ExchangeBackend."
        }
    ],
    "trust_zones": [
      {
        "id": "tz_user_device",
        "name": "User Device",
        "description": "The user's device, including the wallet, browser, and mobile app."
      },
      {
        "id": "tz_internet",
        "name": "Internet",
        "description": "The public Internet."
      },
      {
        "id": "tz_exchange_internal",
        "name": "Exchange Internal",
        "description": "The internal network of the exchange."
      }
    ],
    "trust_boundaries": [
      {
        "id": "tb_wallet_to_internet",
        "trust_zone_a": "tz_user_device",
        "trust_zone_b": "tz_internet",
        "access_control_methods": [
            "abac"
        ],
        "authentication_methods": [
            "none"
        ]
      }
    ],
  
    "actors": [
      {
        "id": "actor_user",
        "type": "human",
        "name": "End-User",
        "description": "A legitimate user interacting via wallet GUI, browser or mobile app."
      }
    ],
  
    "components": [
      {
        "symbolic_name": "comp_wallet_gui",
        "title": "Electrum Wallet GUI",
        "trust_zone": "tz_user_device",
        "description": "Desktop wallet graphical user interface."
      },
      {
        "symbolic_name": "comp_wallet_daemon",
        "title": "Electrum Wallet Daemon",
        "trust_zone": "tz_user_device",
        "description": "Local wallet backend process exposing HTTP JSON-RPC on localhost."
      },
      {
        "symbolic_name": "comp_electrumx",
        "title": "ElectrumX Server",
        "trust_zone": "tz_internet",
        "description": "Third-party SPV server that wallets connect to for blockchain data."
      },
      {
        "symbolic_name": "comp_browser",
        "title": "Web Browser",
        "trust_zone": "tz_user_device",
        "description": "Browser used to access exchange website or interact with local wallet UI."
      },
      {
        "symbolic_name": "comp_mobile_app",
        "title": "Mobile App",
        "trust_zone": "tz_user_device",
        "description": "Mobile application variant for wallet or exchange interaction."
      },
      {
        "symbolic_name": "comp_exchange_website",
        "title": "Exchange Website (Front-end)",
        "trust_zone": "tz_internet",
        "description": "Frontend served to users, interacts with backend via HTTPS."
      },
      {
        "symbolic_name": "comp_exchange_backend",
        "title": "Exchange Backend",
        "trust_zone": "tz_exchange_internal",
        "description": "Backend server handling business logic, config, user data, etc."
      },
      {
        "symbolic_name": "comp_exchange_api",
        "title": "Exchange API (Node.js)",
        "trust_zone": "tz_exchange_internal",
        "description": "API server providing programmatic access to exchange functions (e.g. trading, account data)."
      },
      {
        "symbolic_name": "comp_trading_bot",
        "title": "Trading Bot",
        "trust_zone": "tz_user_device",
        "description": "User-run bot using API keys to interact with Exchange API (via secure WebSocket)."
      },
      {
        "symbolic_name": "comp_blockchain_integration",
        "title": "Blockchain Integration Module",
        "trust_zone": "tz_exchange_internal",
        "description": "Module that interfaces with blockchain network to read/write blockchain state."
      }
    ],
  
    "data_stores": [
      {
        "symbolic_name": "store_wallet_file",
        "title": "Wallet File",
        "trust_zone": "tz_user_device",
        "description": "Local wallet file stored at rest (should be encrypted).",
        "type": "file"
      },
      {
        "symbolic_name": "store_mysql_config",
        "title": "MySQL (User & Config)",
        "trust_zone": "tz_exchange_internal",
        "description": "Relational database storing user accounts and configuration.",
        "type": "database"
      },
      {
        "symbolic_name": "store_mongodb",
        "title": "MongoDB (Exchange Data)",
        "trust_zone": "tz_exchange_internal",
        "description": "NoSQL store used by Exchange API for trading data, logs, etc.",
        "type": "database"
      }
    ],
  
    "data_sets": [
      {
        "symbolic_name": "ds_wallet_data",
        "title": "Wallet Data",
        "description": "Data stored in the wallet file.",
        "placements": ["store_wallet_file"],
        "data_sensitivity": ["cred"]
      },
      {
        "symbolic_name": "ds_exchange_user_data",
        "title": "Exchange User & Config Data",
        "description": "Data stored in the MySQL database.",
        "placements": ["store_mysql_config"],
        "data_sensitivity": ["cred"]
      },
      {
        "symbolic_name": "ds_exchange_operational_data",
        "title": "Exchange Operational Data (trades, logs, metadata)",
        "description": "Data stored in the MongoDB database.",
        "placements": ["store_mongodb"],
        "data_sensitivity": ["biz"]
      }
    ],
  
    "data_flows": [
      {
        "symbolic_name": "df_user_to_browser",
        "title": "User to Browser",
        "source": "actor_user",
        "destination": "comp_browser",
        "description": "User interacts with browser.",
        "has_sensitive_data": false,
        "encrypted": true
      },
      {
        "symbolic_name": "df_user_to_wallet_gui",
        "title": "User to Wallet GUI",
        "source": "actor_user",
        "destination": "comp_wallet_gui",
        "description": "User interacts with wallet GUI.",
        "has_sensitive_data": false,
        "encrypted": true
      },
      {
        "symbolic_name": "df_wallet_gui_to_daemon",
        "title": "Wallet GUI to Daemon",
        "source": "comp_wallet_gui",
        "destination": "comp_wallet_daemon",
        "description": "Local IPC/loopback HTTP JSON-RPC calls from GUI to daemon.",
        "protocol": "HTTP JSON-RPC",
        "authentication": "none (localhost)",
        "has_sensitive_data": false,
        "encrypted": true
      },
      {
        "symbolic_name": "df_wallet_daemon_to_electrumx",
        "title": "Wallet Daemon to ElectrumX",
        "source": "comp_wallet_daemon",
        "destination": "comp_electrumx",
        "description": "Daemon connects to ElectrumX over Internet for SPV / blockchain queries.",
        "protocol": "TCP + SSL",
        "authentication": "none",
        "crosses_trust_boundary": "tb_wallet_to_internet",
        "has_sensitive_data": false,
        "encrypted": true
      },
      {
        "symbolic_name": "df_browser_to_exchange_website",
        "title": "Browser to Exchange Website",
        "source": "comp_browser",
        "destination": "comp_exchange_website",
        "description": "HTTPS requests to exchange website frontend.",
        "protocol": "HTTPS",
        "crosses_trust_boundary": "tz_user_device → tz_internet",
        "has_sensitive_data": false,
        "encrypted": true
      },
      {
        "symbolic_name": "df_website_to_backend",
        "title": "Website to Backend",
        "source": "comp_exchange_website",
        "destination": "comp_exchange_backend",
        "description": "HTTPS requests from front-end to backend.",
        "protocol": "HTTPS",
        "crosses_trust_boundary": "tz_internet → tz_exchange_internal",
        "has_sensitive_data": false,
        "encrypted": true
      },
      {
        "symbolic_name": "df_trading_bot_to_exchange_api",
        "title": "Trading Bot to Exchange API",
        "source": "comp_trading_bot",
        "destination": "comp_exchange_api",
        "description": "Secure WebSocket (or HTTPS) API calls to exchange API.",
        "protocol": "WebSocket Secure (or HTTPS)",
        "crosses_trust_boundary": "tz_user_device → tz_exchange_internal",
        "has_sensitive_data": false,
        "encrypted": true
      },
      {
        "symbolic_name": "df_backend_to_mongodb",
        "title": "Backend to MongoDB",
        "source": "comp_exchange_backend",
        "destination": "store_mongodb",
        "description": "Backend writes/reads operational data to MongoDB.",
        "has_sensitive_data": false,
        "encrypted": true
      },
      {
        "symbolic_name": "df_backend_to_mysql",
        "title": "Backend to MySQL",
        "source": "comp_exchange_backend",
        "destination": "store_mysql_config",
        "description": "Backend writes/reads user & config data.",
        "has_sensitive_data": false,
        "encrypted": true
      },
      {
        "symbolic_name": "df_backend_to_blockchain_module",
        "title": "Backend to Blockchain Module",
        "source": "comp_exchange_backend",
        "destination": "comp_blockchain_integration",
        "description": "Backend triggers blockchain read/write operations via integration module.",
        "has_sensitive_data": false,
        "encrypted": true
      },
      {
        "symbolic_name": "df_blockchain_module_to_network",
        "title": "Blockchain Module to Network",
        "source": "comp_blockchain_integration",
        "destination": "tz_blockchain_network",
        "description": "Blockchain integration module interacts with public blockchain network.",
        "crosses_trust_boundary": "tb_exchange_to_blockchain",
        "has_sensitive_data": false,
        "encrypted": true
      }
    ],
  
    "assumptions": [
      {
        "description": "TLS terminates at load balancer; all front-end ↔ backend communication uses HTTPS.",
        "validity": "unconfirmed"
      },
      {
        "description": "User device is not compromised and wallet file encryption (if enabled) protects against local unauthorized access.",
        "validity": "unconfirmed"
      }
    ],
  
    "threat_personas": [
      {
        "symbolic_name": "tp_external_attacker",
        "title": "Remote External Attacker",
        "description": "An unauthenticated adversary on the public Internet trying to intercept or spoof communications.",
        "is_person": true,
        "skill_level": "intermediate",
        "access_level": "public",
        "malicious_intent": true,
        "applicability_to_org": "high" 
      }
    ],
  
    "threats": [
      {
        "symbolic_name": "T1",
        "title": "No authentication for wallet-to-SPV server connection",
        "description": "The wallet daemon connects to the SPV server over TCP+SSL without authentication, allowing a man-in-the-middle or rogue SPV server to feed false blockchain data.",
        "threat_persona": "tp_external_attacker",
        "event": "Network spoofing / MITM",
        "weakness": "Missing authentication / server validation",
        "sources": ["comp_wallet_daemon", "comp_electrumx", "df_wallet_daemon_to_electrumx"]
      }
    ],
  
    "controls": [
      {
        "symbolic_name": "Encrypt wallet file at rest",
        "title": "Encrypt wallet file at rest",
        "description": "Ensure the local wallet file is encrypted to protect against unauthorized access if device is compromised.",
        "threats": ["store_wallet_file"],
        "status": "in_progress",
        "priority": "high"
      },
      {
        "symbolic_name": "Use read-only API key for trading bot",
        "title": "Use read-only API key for trading bot",
        "description": "Restrict API key used by trading bot to read-only permissions to minimize risk of unauthorized operations.",
        "threats": ["comp_trading_bot", "comp_exchange_api"],
        "status": "in_progress",
        "priority": "high"
      },
      {
        "symbolic_name": "Add authentication and host-header validation for exchange API and backend",
        "title": "Add authentication and host-header validation for exchange API and backend",
        "description": "Require proper authentication, validate host headers, and enforce TLS to prevent unauthorized or spoofed requests.",
        "threats": ["comp_exchange_api", "comp_exchange_backend", "df_trading_bot_to_exchange_api", "df_website_to_backend"],
        "status": "in_progress",
        "priority": "high"
      }
    ]
}